$(document).ready(function() {

  $('#mixContainer').mixItUp();


  $(".submit-note-button").off('click').on('click', function(e){
    $this = $(this);
    e.preventDefault();

    var postData = $($this).closest('form').serialize();

    $.ajax({
      url: window.location.origin + "/brain_dump_notes" ,
      type: "POST",
      data: postData,
      format: 'js',
      success:function(data, textStatus, jqXHR) {
      },
      error: function(jqXHR, textStatus, errorThrown){
      }
    });
  });



  $(".show-note-form").off('click').on('click', function(e) {
    e.preventDefault();
    var $this = $(this),
        NoteForm = $this.parents(".content").find("#NoteForm");
        FileForm = $this.parents(".content").find("#FileForm");

    $(NoteForm).fadeToggle(400).toggleClass('hidden');
    $(FileForm).addClass('hidden');
  });


  $(".show-file-form").off('click').on('click', function(e) {
    e.preventDefault();
    var $this = $(this),
        NoteForm = $this.parents(".content").find("#NoteForm");
        FileForm = $this.parents(".content").find("#FileForm");

    $(FileForm).fadeToggle(400).toggleClass('hidden');
    $(NoteForm).addClass('hidden');
  });


  $(function() {
    $.each($(".circle[data-done='true']"), function() {
      $(this).addClass('done');
      $(this).find('.fa-check').css('display','inline');
      var parentElem = $(this).closest('.brain_dump_info').attr('id');
      $(".brain-dump-tab[href=#" + parentElem +"]").append('<img src="/assets/green_checkmark.png" />');
    });
  });


  $(function() {
    $(".circle").off('click').on('click', function() {
      var $this = $(this),
          brainDumpId = $this.attr('data-id'),
          parentElem = $this.closest('.brain_dump_info').attr('id');

      var url = window.location.origin + "/brain_dumps/" + brainDumpId + '/check_done'

      $.getJSON( url, function( data ) {
        if(data === true) {
          $this.removeClass('done');
          $this.find('.fa-check').css('display','none');
          $this.attr('data-done', false);
          $(".brain-dump-tab[href=#" + parentElem +"]").children("img").remove();
        } else {
          $this.addClass('done');
          $this.find('.fa-check').css('display','inline');
          $this.attr('data-done', true);
          $(".brain-dump-tab[href=#" + parentElem +"]").append("<img src='/assets/green_checkmark.png' />");
        }
      });

      $.ajax({
        url: window.location.origin + "/brain_dumps/" + brainDumpId + '/update_completion',
        type: 'PUT',
        format: 'json',
        cache: false
      });
    });
  });


  $(function() {
    $(".brain-dump-tab").on('click', function(e) {
      e.preventDefault();
      var target = $(this).attr('href');
      $(target).show().siblings('div.brain_dump_info').hide();
    });
  });


  $(function() {
    $( "#category_tabs" ).tabs({
      create: function( event, ui ) {
        $(function() {
          $.each($(".category-box"), function() {
            $(this).hide();
          });
        });
      },
      activate: function( event, ui ) {
        $.each($(".mix"), function() {
          $(this).hide();
        });


        $.each($(".ac-custom-list-item"), function() {
          var width = $(this).width();
          $(this).height(width);

          var inner = $(this).find('.list-item-inner');
          $(inner).css('line-height',(width-10).toString()+'px')

        });
      }
    });
  });

});


